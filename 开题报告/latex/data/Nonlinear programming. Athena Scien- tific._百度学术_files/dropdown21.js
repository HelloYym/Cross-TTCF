(function(){var d=/msie (\d+\.\d+)/i.test(navigator.userAgent)?(document.documentMode||+RegExp["\x241"]):undefined,c=[],b;A.ui.dropdown21=function(g,e){var f=new a(g,e);c.push(f);return f.outInterface()};function a(g,e){var h=e||{};var f=this;f.op={appendTo:null,type:"common",lineHeight:26,width:0,height:0,vscrollbar:true,onchange:null,onopen:null,onclose:null,number:10};$.extend(f.op,h);f.className="c-dropdown2";f.dom=null;f.btn=null;f.menu=null;f.menuInner=null;f.allItems=[];f.groups=[];f.items=[];f.menuItems=[];f.groupItems=[];f.index=-1;f.bakIndex=null;f.value=null;f.text=null;f.events={keymove:function(i){f.keyMove(i)},bodyclick:function(j){var i=j.target||j.srcElement;if(!$.contains(f.dom,i)){f.close();f.stopPropagation(j)}}};return f.init(g)}a.prototype={init:function(g){var f=this;if(g.nodeType){f.dom=g;f.initDoms();f.allItems=f.domToData()}else{f.allItems=g;f.dom=f.itemToDom();f.initDoms()}f.setIndex(f.index);f.container=f.op.appendTo||f.dom.parentNode;if(f.op.appendTo&&f.container){f.container.appendChild(f.dom)}var e=$(f.dom);e.addClass(f.className+"-"+f.op.type+" OP_LOG_BTN");e.attr({"data-click":"{fm:'beha'}",tabindex:0});f.initDisplay();f.bindEvent();return f},domToData:function(){var n=this,k=-1,e=0,p=$(n.dom);n.groupItems=p.find(".c-dropdown2-group");n.menuItems=p.find(".c-dropdown2-option");if(n.op.type==="common"){n.allItemsMenuItems=n.menubox.children}else{n.allItemsMenuItems=n.menuItems}for(var g=0,f;f=n.allItemsMenuItems[g];g++){var h=$(f);if(h.hasClass("c-dropdown2-group")){var j={group:true,text:$.trim(f.innerHTML),index:++k};n.groups.push(j)}else{if(h.hasClass("c-dropdown2-option")){var l=f.getAttribute("data-text");var m={value:$.trim(f.getAttribute("data-value")),text:l?l:h.text(),groupIndex:k,selected:f.getAttribute("data-selected")?true:false};if(m.selected){n.index=e}n.items.push(m);e++}}}if(n.groups.length){$(n.menu).addClass("c-dropdown2-menu-group")}},itemToDom:function(){var g=this;g.dom=g.createEle("div",{key:"data-click",value:"{fm:'beha'}",tabindex:0},g.className+" OP_LOG_BTN");var e=g.buildMenu();var f='<div class="c-dropdown2-btn-group">    <div class="c-dropdown2-btn"></div>    <div class="c-dropdown2-btn-icon">        <div class="c-dropdown2-btn-icon-border">            <i class="c-icon c-icon-triangle-down"></i>         </div>    </div></div><div class="c-dropdown2-menu'+(g.groups.length?" c-dropdown2-menu-group":"")+'">    <div class="c-dropdown2-menu-inner">         <ul class="c-dropdown2-menubox">'+e+"</ul>     </div></div>";g.dom.innerHTML=f;return g.dom},buildMenu:function(){var j=this;j.groups=[];j.items=[];var f=[];var h="";var k=-1;var e=0;for(var g=0,l;l=j.allItems[g];g++){if(l.group&&!l.value){l.index=++k;h="c-dropdown2-group";j.groups.push(l)}else{l.groupIndex=k;h="c-dropdown2-option";j.items.push(l);if(l.selected&&e>=0){j.index=e}e++}f.push('<li class="'+h+'" data-value="'+l.value+'">'+l.text+"</li>")}return f.join("")},initDoms:function(){var f=this,e=$(f.dom);f.btn=e.find(".c-dropdown2-btn")[0];f.btnGroup=e.find(".c-dropdown2-btn-group")[0];f.menu=e.find(".c-dropdown2-menu")[0];f.menuInner=e.find(".c-dropdown2-menu-inner")[0];f.menubox=e.find(".c-dropdown2-menubox")[0];f.groupItems=e.find(".c-dropdown2-group").get();f.menuItems=e.find(".c-dropdown2-option").get()},initDisplay:function(){var e=this;e.menu.style.visibility="hidden";e.setMenuHeight();if(e.op.width){e.menu.style.width=e.op.width+"px"}if(e.op.height){e.menu.style.height=e.op.height+"px";e.menuInner.style.height=e.op.height+"px"}e.setZIndex()},add:function(j,e){var g=this,e=!isNaN(e)?e:g.get().length,h=$(g.menu);if(e>g.get().length||g.get().length===0){e=g.get().length}if(g.type(j)==="[object Array]"){for(var f=0,k;k=j[f];f++){g.add.call(g,k,k.group?e:e++)}}else{if(j.group){g.addGroup(j,e)}else{g.addItem(j,e)}}if(g.groups.length){h.addClass("c-dropdown2-menu-group")}else{h.removeClass("c-dropdown2-menu-group")}},addGroup:function(q,k){var r=this,m,n,f=false,j=-1,p=-1,g=r.createEle("li",{},"c-dropdown2-group",q.text);if(r.op.type==="common"){m=r.menubox.children}else{m=$(r.dom).find(".c-dropdown2-option").get()}r.addDom(g,k);r.groups.splice(k,0,q);r.groupItems.splice(k,0,g);for(var h=0,e;e=m[h];h++){var l=$(e);if(l.hasClass("c-dropdown2-option")){j++}if(l.hasClass("c-dropdown2-group")){p++}if(e===g){if(m[h-1]&&$(m[h-1]).hasClass("c-dropdown2-group")){$(m[h-1]).remove();r.groups.splice(h-1,1);p--;f=false}else{n=h;f=true}}if(h>=n&&f){if(l.hasClass("c-dropdown2-group")){r.groups[p]["index"]=p}else{r.items[j].groupIndex=p}}}r.setMenuHeight();if(r.vscroll){r.vscroll.render()}if(r.groups.length){$(r.menu).addClass("c-dropdown2-menu-group")}return true},addItem:function(h,f){var g=this,i=-1,k=g.createOption(h);g.addDom(k,f);if(g.groups.length>0){if(g.get().length===0){i=0}else{if(f>=g.get().length){i=g.groups.length-1}else{i=g.items[f]["groupIndex"]}}}h.groupIndex=i;g.items.splice(f,0,h);g.menuItems.splice(f,0,k);if(f<=g.index){g.index++}if(h.selected||g.index===-1){g.setIndex(f)}else{h.selected=false}g.bindMenuEvent(k);g.setMenuHeight();try{if(g.vscroll){g.vscroll.render()}}catch(j){}return true},remove:function(k){var n=this;if(isNaN(k)||k>=n.get().length){return}var m=n.items[k];var l=m.groupIndex;var e=n.menuItems[k];var j=e.parentNode;n.items.splice(k,1);j.removeChild(e);n.menuItems.splice(k,1);if(n.groups.length&&l>=0){var g=false,h=0;for(var h=0,f;f=n.items[h];h++){if(f.groupIndex<=l){if(f.groupIndex==l){g=true;break}}else{break}}if(!g){n.groups.splice(l,1);j.removeChild(n.groupItems[l]);n.groupItems.splice(l,1);for(var h=k,f;f=n.items[h];h++){f.groupIndex=f.groupIndex-1}}}if(k<n.index){n.index--}else{if(k===n.index){n.setIndex(0)}}if(n.get().length===0){n.empty()}n.setMenuHeight();if(n.vscroll){n.vscroll.render()}},removeAll:function(){var e=this;e.empty();e.setMenuHeight()},empty:function(){var g=this;g.btn.innerHTML="";if(g.op.type==="common"){g.menubox.innerHTML=""}else{for(var f=0,e=g.items.length;f<e;f++){g.remove(0)}}g.items=[];g.menuItems=[];g.groups=[];g.groupItems=[];g.index=-1;if(g.hiddenInput){g.hiddenInput.value=""}},setIndex:function(e){var f=this;if(isNaN(e)||!f.items.length||e>=f.items.length){return}if(e<0){e=0}if(f.items[f.index]&&f.menuItems[f.index]){$(f.menuItems[f.index]).removeClass("c-dropdown2-selected");f.items[f.index]["selected"]=false;f.menuItems[f.index].removeAttribute("data-selected")}f.index=e;$(f.menuItems[f.index]).addClass("c-dropdown2-selected");f.items[f.index]["selected"]=true;f.menuItems[f.index].setAttribute("data-selected","selected");var g=f.items[e];var i=g.text?g.text:(g.html?$(f.menuItems[e]).text():"");var h=g.value;f.btn.innerHTML=i;f.text=i;f.value=h;if(f.hiddenInput){f.hiddenInput.value=f.value}f.croodMenuItem();return this},setName:function(e){var f=this;var g=f.hiddenInput;if(g){g.name=e}else{g=f.createEle("input",{type:"hidden",name:e});f.dom.appendChild(g);f.hiddenInput=g}g.value=f.value},setValue:function(f){for(var e=0,g;g=this.items[e];e++){if(f===g.value){this.setIndex(e);break}}},setMenuHeight:function(){var e=this;if(e.op.type!=="common"){return}var f=e.items.length+e.groups.length;if(f<e.op.number){e.menu.style.height=f*e.op.lineHeight+"px";e.menuInner.style.height=f*e.op.lineHeight+"px"}else{e.menu.style.height="auto";if(e.op.height){e.menuInner.style.height=e.op.height+"px"}else{e.menuInner.style.height=e.op.number*e.op.lineHeight+"px"}}},bindEvent:function(){var e=this;e.bindMenuEvent();$(e.dom).on("click",function(k){var h=k.target||k.srcElement;if(e.matchBtnClass(h.className)){e.dom.focus();e.toggle();var l=c;if(l&&l.length>0){for(var g=0,f=l.length;g<f;g++){if(l[g]!==e){l[g].close&&l[g].close()}}}}e.stopPropagation(k)})},setZIndex:function(j){var g=this;var h=$("."+g.className);for(var f=0,e=h.length;f<e;f++){h[f].style.zIndex=200-2*f}if(j){j.style.zIndex=200+2}},keyMove:function(i){var f=this;switch(i.keyCode){case 38:if(f.index>0){f.setIndex(f.index-1)}else{if(f.index===0){if(f.menuInner.scrollTop!==0){f.menuInner.scrollTop=0}}}f.stopEvent(i);break;case 40:if(f.index<f.get().length-1){f.setIndex(f.index+1)}else{if(f.index===f.get().length-1){var g=(f.menuInner.scrollTop+f.menuInner.offsetHeight)===f.menubox.offsetHeight?true:false;if(f.menuInner.scrollTop>0&&!g){f.menuInner.scrollTop=f.menubox.offsetHeight-f.menuInner.offsetHeight}}}f.stopEvent(i);break;case 13:if(f.index!==f.bakIndex){var h={target:i.target,oldItem:f.items[f.bakIndex],index:f.index,item:f.items[f.index],stopPropagation:function(){f.stopPropagation(i)},preventDefault:function(){f.preventDefault(i)}};f.op.onchange&&f.op.onchange(h)}f.bakIndex=null;f.close();f.stopEvent(i);break}},bindMenuEvent:function(f){var e=this,g=e.menuItems;if(f){g=[f]}$.each(g,function(h,k){var j=$(k);j.on("mouseover",function(){j.addClass("c-dropdown2-selected")});j.on("mouseout",function(){if(e.menuItems[e.index]!==k){j.removeClass("c-dropdown2-selected")}});j.on("click",function(m){var i=e.getMenuItemIndex(k);if(e.menuItems[e.index]!==k){var l={target:m.target,oldItem:e.items[e.index],index:i,item:e.items[i],stopPropagation:function(){e.stopPropagation(m)},preventDefault:function(){e.preventDefault(m)}};e.setIndex(i);e.op.onchange&&e.op.onchange(l)}e.bakIndex=null;e.close();e.stopPropagation(m)})})},getMenuItemIndex:function(g){var f=this;for(var e=0,h;h=f.menuItems[e];e++){if(g===h){return e}}return 0},createEle:function(h,f,j,k){var l=document.createElement(h);if(f){if(this.type(f)==="[object Object]"){f=[f]}for(var g=0,m;m=f[g];g++){for(var e in m){if(m.hasOwnProperty(e)){l.setAttribute(e,m[e])}}}}if(j!==undefined){l.className=j}if(k!==undefined){l.innerHTML=k}return l},type:function(e){return Object.prototype.toString.call(e)},get:function(e){return e===undefined?this.items:this.items[e]},addDom:function(g,e){var f=this;if(e<f.get().length){$(f.menuItems[e]).before(g)}else{f.menubox.appendChild(g)}},createOption:function(f){var e=this,g={"data-value":f.value};if(f.selected){g["data-selected"]="selected"}if(e.op.type==="common"){return e.createEle("li",g,"c-dropdown2-option",f.html?f.html:f.text)}else{return e.createEle("div",g,"c-dropdown2-option",f.html?f.html:f.text)}},matchBtnClass:function(e){return/\b(c-dropdown2-btn|c-dropdown2-btn-icon|c-dropdown2-btn-group|c-dropdown2-btn-icon-border|c-icon c-icon-triangle-down)\b/.test(e)},toggle:function(){var e=this;if(e.menuItems&&e.menuItems[e.index]){$(e.menuItems[e.index]).addClass("c-dropdown2-selected")}e.menu.style.visibility=="hidden"?e.open():e.close();return e},close:function(){var e=this;if(!e.menu||!e.dom){return}if(e.bakIndex!==null&&e.index!==e.bakIndex){e.setIndex(e.bakIndex)}e.bakIndex=null;e.menu.style.visibility="hidden";$(e.dom).removeClass("c-dropdown2-hover");var f={index:e.index,item:e.items[e.index]};e.op.onclose&&e.op.onclose(f);if(e.op.type==="common"){$(document).unbind("keydown",e.events.keymove)}$(document.body).unbind("click",e.events.bodyclick)},open:function(){var e=this;e.setZIndex(e.dom);e.bakIndex=e.index;e.menu.style.visibility="visible";$(e.dom).addClass("c-dropdown2-hover");var g={index:e.index,item:e.items[e.index]};e.op.onopen&&e.op.onopen(g);var h=(e.items.length+e.groups.length)>e.op.number;if(h){e.croodMenuItem()}if(!e.op.width){e.menu.style.width=e.dom.offsetWidth-2+"px";var f=e.menuInner.scrollWidth;if(f>e.menu.offsetWidth){e.menu.style.width=f+(h?18:10)+"px"}}if(e.op.vscrollbar&&!e.vscroll&&h){e.vscrollbar()}e.menubox.style.width=e.dom.offsetWidth+"px";b=setTimeout(function(){e.menubox.style.width=""},0);if(e.op.type==="common"){$(document).bind("keydown",e.events.keymove)}$(document.body).bind("click",e.events.bodyclick)},setMenuPosition:function(){var e=this,f=e.menu.offsetHeight,k=$(e.dom).position(),j=document.documentElement.clientHeight;var g=document.documentElement.scrollTop||document.body.scrollTop;var i={};i.top=k.top-g;i.bottom=j-i.top-e.dom.offsetHeight;if(d){i.bottom+=g}if(i.bottom<f&&i.top>=f){e.menu.style.top=-f+"px"}else{e.menu.style.top=e.dom.offsetHeight+"px"}},croodMenuItem:function(){var g=this;if(g.get().length>0){var h=g.menuItems[g.index],i=h.offsetTop,k=h.offsetHeight,j=g.menuInner.offsetHeight,e=g.menuInner.scrollTop,f=i+k-e;if(e<=i&&f<=j){}else{if(e>i){g.menuInner.scrollTop=i}else{if(f>j){g.menuInner.scrollTop=i+k-j}}}}},vscrollbar:function(){var e=this;e.menuInner.style.overflowY="hidden";A.use("scrollbarv",function(){e.vscroll=A.ui.scrollbarv({content:e.menuInner,initDom:e.menuItems[e.index],mousewheellock:true})})},stopPropagation:function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopEvent:function(g){var f=this;f.stopPropagation(g);f.preventDefault(g)},outInterface:function(){var e=this;return{get:function(f){return e.get(f)},getAll:function(){return e.get()},getLength:function(){return e.get().length},getIndex:function(){return e.index},setIndex:function(f){e.setIndex(f);return this},getName:function(){return e.hiddenInput?e.hiddenInput.name:undefined},setName:function(f){e.setName(f);return this},getValue:function(){return e.value},setValue:function(f){e.setValue(f);return this},getText:function(){return e.items[e.index]?e.items[e.index].text:""},add:function(g,f){e.add(g,f);return this},remove:function(f){e.remove(f);return this},removeAll:function(){e.removeAll();return this},open:function(){e.open();return this},close:function(){e.close();return this},appendTo:function(f){e.appendTo(f);return this},dispose:function(){e.dispose()},t:function(){return e}}},dispose:function(){var e=this;if(e.op.type==="common"){$(document).unbind("keydown",e.events.keymove)}$(document.body).unbind("click",e.events.bodyclick);if(b){clearTimeout(b)}}}})();